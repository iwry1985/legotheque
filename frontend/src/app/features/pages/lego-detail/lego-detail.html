<div class="details-page">
  <div class="details-layout">
    <div class="details flex space-between container">
      <!-- IMAGE -->
      <div class="right img">
        <img class="lego" [src]="legoset.thumbnail" [alt]="legoset.thumbnail" />
      </div>

      <!-- INFOS GAUCHE -->
      <div class="left">
        @if(themeLogo) {
        <div class="theme">
          @if(themeLogo.logo) {
          <img [src]="themeLogo.logo" [alt]="themeLogo.name" />
          } @else {
          <h6>{{ themeLogo.name }}</h6>
          }
        </div>
        } @if(legoset.retired) {
        <div class="tag-retired">
          <p-tag
            severity="danger"
            value="Officiellement retiré de la vente"
            icon="pi pi-stop-circle"
          ></p-tag>
        </div>
        } @if(legoset.newest) {
        <div class="tag-retired">
          <p-tag
            icon="pi pi-sparkles"
            severity="info"
            value="Nouveauté"
          ></p-tag>
        </div>
        } @if(legoset.retiredSoon) {
        <div class="tag-retired">
          <p-tag
            icon="pi pi-info-circle"
            severity="warn"
            value="Bientôt retiré"
          ></p-tag>
        </div>
        }

        <h2>{{ legoset.name }}</h2>

        <div class="infos flex">
          <div class="item-flex">{{ legoset.reference | ref }}</div>
          <div class="item-flex">{{ legoset.pieces | pieces }}</div>
          <div class="item-flex">{{ legoset.year }}</div>
        </div>

        <div class="extra-infos">
          @if(legoset.retailprice) {
          <p>
            <span class="label">Prix LEGO : </span>
            <span class="value"
              >{{ legoset.retailprice | currency: 'EUR' }}</span
            >
          </p>
          } @if(legoset.minage) {
          <p>
            <span class="label">Âge min : </span>
            <span class="value">{{ legoset.minage }}+</span>
          </p>
          } @if(legoset.minifigs && legoset.minifigs > 0) {
          <p>
            <span class="label">Figurines : </span>
            <span class="value">{{ legoset.minifigs }}</span>
          </p>
          } @if(legoset.launchdate) {
          <p>
            <span class="label">Sortie : </span>
            <span class="value">
              {{ legoset.launchdate | date: 'MMMM yyyy': 'Europe/Brussels':
              'fr-FR' }}
            </span>
          </p>
          } @if(legoset.exitdate && !legoset.retired) {
          <p>
            <span class="label">Fin prévue : </span>
            <span class="value">
              {{ legoset.exitdate | date: 'MMMM yyyy': 'Europe/Brussels':
              'fr-FR' }}
            </span>
          </p>
          } @if(legoset.exitdate && legoset.retired) {
          <p>
            <span class="label">Fini depuis : </span>
            <span class="value">
              {{ legoset.exitdate | date: 'MMMM yyyy': 'Europe/Brussels':
              'fr-FR' }}
            </span>
          </p>
          }
        </div>

        <!-- ACTIONS UTILISATEUR -->
        @if(authService.connectedUser()) {
        <div class="user-actions">
          <div class="actions flex">
            <!-- Ajouter -->
            @if(!myLego()) {
            <p-button
              label="Ajouter"
              icon="pi pi-plus"
              size="large"
              (onClick)="ownSet()"
            ></p-button>
            } @else {
            <!-- Possédé -->
            <p-tag
              icon="pi pi-face-smile"
              value="Possédé"
              severity="info"
            ></p-tag>

            <!-- Construit / Non construit -->
            @if(!myLego()!.built) {
            <p-tag
              icon="pi pi-circle-off"
              value="Non construit"
              severity="warn"
            ></p-tag>
            } @else {
            <p-tag
              icon="pi pi-check-circle"
              value="Construit"
              severity="success"
            ></p-tag>
            } }

            <!-- Liste de souhaits -->
            @if(!myLego() && !wanted()) {
            <p-button
              label="Je le veux !"
              icon="pi pi-heart-fill"
              size="large"
              severity="danger"
              class="item-flex"
              (onClick)="addAsWanted()"
            ></p-button>
            } @if(wanted() && !myLego()) {
            <p-button
              label="Je ne le veux plus !"
              icon="pi pi-heart"
              size="large"
              severity="contrast"
              class="item-flex"
              (onClick)="removeFromWanted()"
            ></p-button>
            }
          </div>

          @if(wanted() && !myLego()) {
          <div class="wanted-since">
            Dans la liste de souhaits depuis {{ wanted()?.wantedat | date:
            'dd/MM/yyyy' }}
          </div>
          }
        </div>
        }
      </div>
    </div>
  </div>

  <!-- SECONDARY MARKET -->
  @if(marketPrices) {
  <div class="market">
    <h2>Marché secondaire</h2>
    <div class="tables container">
      <app-secondary-market section="current" [prices]="marketPrices.current" />
      <app-secondary-market
        section="last6Months"
        [prices]="marketPrices.last6Months"
      />
    </div>
  </div>

  }

  <!-- MA COLLECTION -->
  @if(myLego()) {
  <div class="collection flex container">
    <div class="left">
      <app-lego-collection
        [legoset]="legoset"
        [myLego]="myLego()!"
        (updateLegotheque)="updateLegotheque($event)"
      ></app-lego-collection>
    </div>

    <div class="right">
      <app-lego-summary [myLego]="myLego()!"></app-lego-summary>
    </div>
  </div>
  }
</div>
